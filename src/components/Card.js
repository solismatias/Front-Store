import React, { Component } from 'react'
// Redux
import { connect } from 'react-redux'
import { addItem } from '../redux/cartSlice';
// React Router
import { Link } from 'react-router-dom/cjs/react-router-dom.min';


export class Card extends Component {
  addToCart(product) {
    this.props.addItem({ attributes: {}, item: product, amount: 1 })
  }
  productInCart(product) {
    let index = this.props.cart.products.findIndex(e => e.id === product.id)
    return index !== -1
  }
  render() {
    const { product } = this.props
    return (
      <div className='card' >
        <Link to={`/product/${product.id}`}>
          {product.inStock ? null : <span className='card__stock'>OUT OF STOCK</span>}
          <div className='card__image-container'>
            <img className='card__image' alt="product" src={product.gallery[0]} />
          </div>
        </Link>
        {
          product.inStock ?
            this.productInCart(product) ?
              <Link to={"/cart"}>
                < span className='card__cart'>
                  <svg width="35px" height="35px" viewBox="0 0 35 35" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18.083 31.719C14.313 31.719 10.696 30.221 8.029 27.554C5.363 24.887 3.864 21.271 3.864 17.5C3.864 13.729 5.363 10.113 8.029 7.446C10.696 4.78 14.313 3.282 18.083 3.282C18.374 3.282 18.652 3.396 18.857 3.602C19.062 3.807 19.178 4.085 19.178 4.375C19.178 4.666 19.062 4.943 18.857 5.149C18.652 5.354 18.374 5.469 18.083 5.469C14.893 5.469 11.832 6.736 9.576 8.993C7.32 11.249 6.052 14.309 6.052 17.5C6.052 20.691 7.32 23.751 9.576 26.007C11.832 28.264 14.893 29.532 18.083 29.532C19.677 29.537 21.257 29.222 22.727 28.605C24.198 27.989 25.529 27.084 26.643 25.943C26.849 25.737 27.127 25.62 27.419 25.619C27.711 25.617 27.989 25.732 28.197 25.936C28.404 26.142 28.52 26.42 28.523 26.712C28.524 27.003 28.41 27.283 28.204 27.49C26.885 28.833 25.309 29.901 23.571 30.626C21.833 31.353 19.968 31.724 18.083 31.719Z" fill="#FFFFFF" /><path d="M17.646 22.532C17.502 22.532 17.36 22.504 17.227 22.449C17.094 22.394 16.974 22.313 16.873 22.211L11.039 16.378C10.847 16.17 10.742 15.896 10.746 15.612C10.751 15.329 10.866 15.058 11.066 14.859C11.267 14.658 11.537 14.543 11.821 14.538C12.104 14.533 12.378 14.638 12.585 14.832L17.646 19.892L29.313 8.225C29.413 8.118 29.533 8.031 29.667 7.972C29.801 7.912 29.947 7.88 30.093 7.877C30.24 7.875 30.386 7.902 30.522 7.957C30.659 8.011 30.783 8.093 30.886 8.197C30.99 8.301 31.072 8.425 31.127 8.561C31.182 8.697 31.21 8.843 31.206 8.99C31.204 9.137 31.171 9.282 31.112 9.416C31.052 9.55 30.966 9.671 30.858 9.771L18.462 22.167C18.361 22.283 18.235 22.375 18.094 22.439C17.954 22.502 17.8 22.533 17.646 22.532Z" fill="#FFFFFF" /></svg>
                </span>
              </Link>
              :
              < span className='card__cart' onClick={() => this.addToCart(product)}>
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 25 19" fill="none" stroke="none">
                  <path className='cart' d="M19.5613 3.87359C19.1822 3.41031 18.5924 3.12873 17.9821 3.12873H5.15889L4.75914 1.63901C4.52718 0.773016 3.72769 0.168945 2.80069 0.168945H0.653099C0.295301 0.168945 0 0.450523 0 0.793474C0 1.13562 0.294459 1.418 0.653099 1.418H2.80069C3.11654 1.418 3.39045 1.61936 3.47434 1.92139L6.04306 11.7077C6.27502 12.5737 7.07451 13.1778 8.00152 13.1778H16.4028C17.3289 13.1778 18.1507 12.5737 18.3612 11.7077L19.9405 5.50575C20.0877 4.941 19.9619 4.33693 19.5613 3.87365L19.5613 3.87359ZM18.6566 5.22252L17.0773 11.4245C16.9934 11.7265 16.7195 11.9279 16.4036 11.9279H8.00154C7.68569 11.9279 7.41178 11.7265 7.32789 11.4245L5.49611 4.39756H17.983C18.1936 4.39756 18.4042 4.49824 18.5308 4.65948C18.6567 4.81994 18.7192 5.0213 18.6567 5.22266L18.6566 5.22252Z" fill="#FFFFFF" />
                  <path className='cart' d="M8.44437 13.9814C7.2443 13.9814 6.25488 14.9276 6.25488 16.0751C6.25488 17.2226 7.24439 18.1688 8.44437 18.1688C9.64445 18.1696 10.6339 17.2234 10.6339 16.0757C10.6339 14.928 9.64436 13.9812 8.44437 13.9812V13.9814ZM8.44437 16.9011C7.9599 16.9011 7.58071 16.5385 7.58071 16.0752C7.58071 15.6119 7.9599 15.2493 8.44437 15.2493C8.92885 15.2493 9.30804 15.6119 9.30804 16.0752C9.30722 16.5188 8.90748 16.9011 8.44437 16.9011Z" fill="#FFFFFF" />
                  <path className='cart' d="M15.6875 13.9814C14.4875 13.9814 13.498 14.9277 13.498 16.0752C13.498 17.2226 14.4876 18.1689 15.6875 18.1689C16.8875 18.1689 17.877 17.2226 17.877 16.0752C17.8565 14.9284 16.8875 13.9814 15.6875 13.9814ZM15.6875 16.9011C15.2031 16.9011 14.8239 16.5385 14.8239 16.0752C14.8239 15.612 15.2031 15.2493 15.6875 15.2493C16.172 15.2493 16.5512 15.612 16.5512 16.0752C16.5512 16.5188 16.1506 16.9011 15.6875 16.9011Z" fill="#FFFFFF" />
                </svg>
              </span>
            :
            null
        }
        <p className='card__name'>{product.name}</p>
        <p className='card__price'>{this.props.currency.symbol}{product.prices[product.prices.findIndex((e) => e.currency.symbol === this.props.currency.symbol)].amount}</p>
      </div >
    )
  }
}

const mapStateToProps = state => ({
  currency: state.currency,
  cart: state.cart,
});

export default connect(mapStateToProps, { addItem })(Card);